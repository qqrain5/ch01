<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Orientation + Motion Demo</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; line-height: 1.8; }
  button { padding: 10px 18px; font-size: 1.2rem; }
  h3 { margin-top: 30px; }
  .val { font-size: 1.1rem; }
</style>
</head>
<body>

<h2>DeviceOrientation + DeviceMotion 整合示範</h2>
<p>按下按鈕後，旋轉手機即可看到資料更新。</p>

<button id="btn">取得感測器授權並開始</button>

<!-- ================ Orientation ================ -->
<h3>DeviceOrientation（方向角度）</h3>
<p class="val">Alpha (Z): <span id="alpha">-</span></p>
<p class="val">Beta (X): <span id="beta">-</span></p>
<p class="val">Gamma (Y): <span id="gamma">-</span></p>

<!-- ================ 加速度 ================ -->
<h3>DeviceMotion（加速度）</h3>
<p class="val">ax: <span id="ax">-</span></p>
<p class="val">ay: <span id="ay">-</span></p>
<p class="val">az: <span id="az">-</span></p>

<!-- ================ 加速度含重力 ================ -->
<h3>DeviceMotion（加速度含重力）</h3>
<p class="val">ax_g: <span id="ax_g">-</span></p>
<p class="val">ay_g: <span id="ay_g">-</span></p>
<p class="val">az_g: <span id="az_g">-</span></p>

<!-- ================ Gyroscope ================ -->
<h3>Gyroscope 旋轉速度（角速度）</h3>
<p class="val">α (速度): <span id="ralpha">-</span></p>
<p class="val">β (速度): <span id="rbeta">-</span></p>
<p class="val">γ (速度): <span id="rgamma">-</span></p>

<script>
const btn = document.getElementById("btn");

// Orientation
const alphaEl = document.getElementById("alpha");
const betaEl = document.getElementById("beta");
const gammaEl = document.getElementById("gamma");

// Acceleration
const axEl = document.getElementById("ax");
const ayEl = document.getElementById("ay");
const azEl = document.getElementById("az");

// Acceleration including gravity
const axgEl = document.getElementById("ax_g");
const aygEl = document.getElementById("ay_g");
const azgEl = document.getElementById("az_g");

// Gyroscope
const rAlpha = document.getElementById("ralpha");
const rBeta = document.getElementById("rbeta");
const rGamma = document.getElementById("rgamma");

btn.addEventListener("click", async () => {
  try {
    // ====== 1. 檢查支援 ======
    if (typeof DeviceOrientationEvent === "undefined") {
      alert("此裝置不支援 DeviceOrientation");
      return;
    }

    // ====== 2. iOS / Android Chrome 可能需要授權 ======
    if (typeof DeviceOrientationEvent.requestPermission === "function") {
      const state = await DeviceOrientationEvent.requestPermission();
      if (state !== "granted") {
        alert("使用者未允許感測器存取");
        return;
      }
    }

    // ====== 3. 啟動 DeviceOrientation ======
    window.addEventListener("deviceorientation", (e) => {
      alphaEl.textContent = e.alpha?.toFixed(2) ?? "-";
      betaEl.textContent = e.beta?.toFixed(2) ?? "-";
      gammaEl.textContent = e.gamma?.toFixed(2) ?? "-";
    });

    // ====== 4. 啟動 DeviceMotion（加速度 + 重力 + 角速度） ======
    window.addEventListener("devicemotion", (e) => {
      // 加速度
      axEl.textContent = e.acceleration?.x?.toFixed(2) ?? "-";
      ayEl.textContent = e.acceleration?.y?.toFixed(2) ?? "-";
      azEl.textContent = e.acceleration?.z?.toFixed(2) ?? "-";

      // 加速度含重力
      axgEl.textContent = e.accelerationIncludingGravity?.x?.toFixed(2) ?? "-";
      aygEl.textContent = e.accelerationIncludingGravity?.y?.toFixed(2) ?? "-";
      azgEl.textContent = e.accelerationIncludingGravity?.z?.toFixed(2) ?? "-";

      // 角速度（Gyroscope）
      rAlpha.textContent = e.rotationRate?.alpha?.toFixed(2) ?? "-";
      rBeta.textContent = e.rotationRate?.beta?.toFixed(2) ?? "-";
      rGamma.textContent = e.rotationRate?.gamma?.toFixed(2) ?? "-";
    });

    // UI 更新
    btn.disabled = true;
    btn.textContent = "感測器啟動中";

  } catch (err) {
    alert("啟動感測器時發生錯誤：" + err);
  }
});
</script>

</body>
</html>
