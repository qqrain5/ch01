<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Focus Defender - Midnight Zen Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        :root {
            --bg-deep: #020617;
            --glass: rgba(255, 255, 255, 0.03);
            --glass-border: rgba(255, 255, 255, 0.1);
            --accent: #8b5cf6; /* Violet */
            --accent-glow: rgba(139, 92, 246, 0.3);
        }

        body {
            background-color: var(--bg-deep);
            color: #f8fafc;
            font-family: 'Inter', -apple-system, sans-serif;
            transition: all 1s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* 玻璃擬態卡片 */
        .glass-card {
            background: var(--glass);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
        }

        /* 專注模式下的色彩變幻 */
        .focus-active {
            background-color: #000000;
        }
        .focus-active .neon-ring {
            box-shadow: 0 0 30px var(--accent-glow), inset 0 0 15px var(--accent-glow);
            border-color: var(--accent);
        }

        /* 霓虹光環動畫 */
        .neon-ring {
            position: relative;
            transition: all 0.8s ease;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        .breathing {
            animation: breathe 4s ease-in-out infinite;
        }

        @keyframes breathe {
            0%, 100% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.02); opacity: 1; box-shadow: 0 0 50px var(--accent-glow); }
        }

        #commLog::-webkit-scrollbar { width: 4px; }
        #commLog::-webkit-scrollbar-thumb { background: var(--glass-border); border-radius: 10px; }

        .log-entry {
            border-left: 2px solid var(--accent);
            background: rgba(139, 92, 246, 0.05);
            animation: fadeIn 0.4s ease-out forwards;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="min-h-screen overflow-x-hidden" id="body">

    <!-- 啟動遮罩 (行動裝置入口) -->
    <div id="permissionOverlay" class="fixed inset-0 z-50 bg-[#020617] flex flex-col items-center justify-center p-10 text-center">
        <div class="relative mb-10">
            <div class="absolute inset-0 bg-violet-500 blur-3xl opacity-20"></div>
            <div class="relative bg-slate-900 w-24 h-24 rounded-[2rem] flex items-center justify-center border border-slate-800">
                <i class="fa-solid fa-wand-magic-sparkles text-4xl text-violet-400"></i>
            </div>
        </div>
        <h1 class="text-4xl font-light tracking-tighter text-white mb-4">Focus <span class="font-bold text-violet-500">Guard</span></h1>
        <p class="text-slate-500 mb-12 text-sm leading-relaxed max-w-xs">
            透過物理翻轉開啟專注空間。<br>請授權感測器權限以開始深度工作。
        </p>
        <button id="startBtn" class="w-full max-w-xs bg-violet-600 hover:bg-violet-500 text-white font-bold py-4 rounded-2xl shadow-2xl shadow-violet-900/20 transition-all active:scale-95">
            進入專注領域
        </button>
        <button id="simModeBtn" class="mt-6 text-[10px] text-slate-600 uppercase tracking-[0.3em] hover:text-slate-400">
            模擬模式 (Simulator)
        </button>
    </div>

    <!-- 主要介面 -->
    <main class="max-w-md mx-auto p-8 pt-12 flex flex-col items-center">
        
        <!-- 狀態顯示 -->
        <div id="statusSection" class="text-center mb-16 transition-all duration-700">
            <div id="statusIcon" class="mb-6 text-slate-700 text-3xl">
                <i class="fa-solid fa-moon"></i>
            </div>
            <h2 id="statusText" class="text-xs font-bold uppercase tracking-[0.4em] text-slate-500">等待翻轉中</h2>
            <div id="statusPulse" class="h-1 w-12 bg-slate-800 mx-auto mt-4 rounded-full overflow-hidden">
                <div class="h-full bg-violet-500 w-0 transition-all duration-1000" id="statusLine"></div>
            </div>
        </div>

        <!-- 計時器 (Neon Ring) -->
        <div class="relative mb-16">
            <div id="timerRing" class="neon-ring w-64 h-64 rounded-full flex flex-col items-center justify-center bg-slate-900/20 backdrop-blur-sm">
                <span id="timeDisplay" class="text-6xl font-extralight tracking-tighter text-white">00:00</span>
                <span class="text-[9px] font-bold uppercase tracking-[0.3em] text-violet-500/60 mt-4">Flow Duration</span>
            </div>
        </div>

        <!-- 通訊日誌 (Communication Area) -->
        <div class="w-full glass-card p-6 mb-8">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-[10px] font-bold uppercase tracking-widest text-slate-400">
                    <i class="fa-solid fa-satellite-dish mr-2 text-violet-500"></i>數據雲端同步
                </h3>
                <div class="flex gap-1">
                    <div class="w-1 h-1 rounded-full bg-violet-500"></div>
                    <div class="w-1 h-1 rounded-full bg-violet-500 opacity-40"></div>
                </div>
            </div>
            <div id="commLog" class="h-28 overflow-y-auto space-y-2 font-mono text-[9px] text-slate-500">
                <div class="opacity-40 italic italic">系統就緒，等待行為觸發...</div>
            </div>
        </div>

        <!-- 數據統計 -->
        <div class="grid grid-cols-2 gap-4 w-full">
            <div class="glass-card p-6 border-none bg-white/5">
                <p class="text-[9px] font-bold uppercase tracking-widest text-slate-500 mb-2">深度時間</p>
                <p class="text-3xl font-light text-white"><span id="focusMin" class="font-bold text-violet-400">0</span> <small class="text-xs opacity-40">M</small></p>
            </div>
            <div class="glass-card p-6 border-none bg-white/5">
                <p class="text-[9px] font-bold uppercase tracking-widest text-slate-500 mb-2">干擾次數</p>
                <p class="text-3xl font-light text-white"><span id="distractCount" class="font-bold text-rose-500">0</span> <small class="text-xs opacity-40">T</small></p>
            </div>
        </div>

        <!-- 重置 -->
        <button id="resetBtn" class="mt-12 text-[10px] font-bold uppercase tracking-[0.2em] text-slate-700 hover:text-violet-400 transition-colors">
            Reset Session
        </button>

    </main>

    <!-- 模擬器控制 -->
    <div id="simControl" class="fixed bottom-8 left-8 right-8 glass-card p-6 hidden z-40 border-violet-500/20">
        <div class="flex justify-between mb-4">
            <span class="text-[10px] font-bold text-violet-400 uppercase tracking-widest">Simulator: Beta Angle</span>
            <span id="betaVal" class="text-[10px] font-mono text-white">0°</span>
        </div>
        <input type="range" id="simSlider" min="-180" max="180" value="0" class="w-full h-1 bg-slate-800 rounded-lg appearance-none cursor-pointer accent-violet-500">
    </div>

    <script>
        // --- 元素選取 ---
        const body = document.getElementById('body');
        const overlay = document.getElementById('permissionOverlay');
        const startBtn = document.getElementById('startBtn');
        const timerRing = document.getElementById('timerRing');
        const timeDisplay = document.getElementById('timeDisplay');
        const commLog = document.getElementById('commLog');
        const statusIcon = document.getElementById('statusIcon');
        const statusText = document.getElementById('statusText');
        const statusLine = document.getElementById('statusLine');
        const focusMinEl = document.getElementById('focusMin');
        const distractCountEl = document.getElementById('distractCount');
        const simSlider = document.getElementById('simSlider');
        const betaValDisplay = document.getElementById('betaVal');

        let isFaceDown = false;
        let seconds = 0;
        let distractions = 0;
        let timer = null;
        let isMonitoring = false;

        // --- 通訊功能 (Communication) ---
        async function syncData(event) {
            const time = new Date().toLocaleTimeString();
            const logId = "ZEN-" + Math.random().toString(36).substr(2, 4).toUpperCase();
            
            const entry = document.createElement('div');
            entry.className = "log-entry p-3 rounded-xl mb-2 text-slate-300";
            entry.innerHTML = `[${time}] ⚡ SYNC START: ${logId}`;
            commLog.prepend(entry);

            try {
                const response = await fetch('https://jsonplaceholder.typicode.com/posts', {
                    method: 'POST',
                    body: JSON.stringify({ event, duration: seconds, device: 'ZenX-1' }),
                    headers: { 'Content-type': 'application/json' }
                });
                if (response.ok) {
                    entry.innerHTML += `<br><span class="text-violet-400">● 數據已加密傳輸至雲端</span>`;
                }
            } catch (e) {
                entry.innerHTML += `<br><span class="text-rose-500">● 通訊異常: ${e.message}</span>`;
            }
        }

        // --- 邏輯判定 ---
        function setFocusMode(active) {
            if (isFaceDown === active) return;
            isFaceDown = active;

            if (isFaceDown) {
                body.classList.add('focus-active');
                timerRing.classList.add('breathing');
                statusIcon.innerHTML = '<i class="fa-solid fa-wind animate-pulse"></i>';
                statusIcon.className = 'mb-6 text-violet-400 text-3xl';
                statusText.innerText = '進入深度流動狀態';
                statusText.className = 'text-xs font-bold uppercase tracking-[0.4em] text-violet-500';
                statusLine.style.width = '100%';
                
                timer = setInterval(() => {
                    seconds++;
                    renderTime();
                    focusMinEl.innerText = Math.floor(seconds / 60);
                }, 1000);
            } else {
                body.classList.remove('focus-active');
                timerRing.classList.remove('breathing');
                statusIcon.innerHTML = '<i class="fa-solid fa-moon"></i>';
                statusIcon.className = 'mb-6 text-slate-700 text-3xl';
                statusText.innerText = '等待翻轉中';
                statusText.className = 'text-xs font-bold uppercase tracking-[0.4em] text-slate-500';
                statusLine.style.width = '0%';

                if (seconds > 0) {
                    distractions++;
                    distractCountEl.innerText = distractions;
                    syncData('FOCUS_INTERRUPTED');
                }
                clearInterval(timer);
            }
        }

        function renderTime() {
            const m = Math.floor(seconds / 60).toString().padStart(2, '0');
            const s = (seconds % 60).toString().padStart(2, '0');
            timeDisplay.innerText = `${m}:${s}`;
        }

        // --- 感測器啟動 ---
        async function init() {
            if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                const p = await DeviceOrientationEvent.requestPermission();
                if (p === 'granted') activate();
            } else { activate(); }
        }

        function activate() {
            isMonitoring = true;
            overlay.style.display = 'none';
            window.addEventListener('deviceorientation', (e) => {
                const beta = Math.abs(e.beta);
                setFocusMode(beta > 165);
            });
        }

        startBtn.onclick = init;
        document.getElementById('simModeBtn').onclick = () => {
            overlay.style.display = 'none';
            document.getElementById('simControl').classList.remove('hidden');
            isMonitoring = true;
        };
        simSlider.oninput = (e) => {
            betaValDisplay.innerText = `${e.target.value}°`;
            if (isMonitoring) setFocusMode(Math.abs(e.target.value) > 165);
        };
        document.getElementById('resetBtn').onclick = () => location.reload();

    </script>
</body>
</html>